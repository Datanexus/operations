#!/bin/sh
# (c) Copyright 2016 DataNexus Inc.  All Rights Reserved.

/usr/local/bin/list-connectors.sh | /usr/bin/grep postgresql-t1-source &> /dev/null
if [ $? != 0 ]; then
#  echo '{"name":"postgresql-t1-source", "config":{"connector.class":"JdbcSourceConnector","topic.prefix":"postgres_","connection.url":"jdbc:postgresql://{{ hostvars[groups['postgresql_source'].0].ansible_eth1.ipv4.address }}/postgres?user={{ postgresql_user }}&ssl=true","table.whitelist":"t1","mode":"incrementing","batch.max.rows":"500","tasks.max":"10"}}' | curl -X POST -d @- http://{{ hostvars[inventory_hostname].ansible_eth0.ipv4.address }}:8083/connectors --header "Content-Type: application/json"
  echo '{"name":"postgresql-t1-source", "config":{"connector.class":"JdbcSourceConnector","topic.prefix":"postgres_","connection.url":"jdbc:postgresql://{{ hostvars[groups['postgresql_source'].0].ansible_eth1.ipv4.address }}/postgres?user={{ postgresql_user }}&ssl=true","table.whitelist":"t1","mode":"timestamp+incrementing","timestamp.column.name":"created","incrementing.column.name":"id","batch.max.rows":"500","tasks.max":"10"}}' | curl -X POST -d @- http://{{ hostvars[inventory_hostname].ansible_eth0.ipv4.address }}:8083/connectors --header "Content-Type: application/json"
fi
